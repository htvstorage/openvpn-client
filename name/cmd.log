   79  for x in `ls agg/*/HPG*table.log`; do echo $x; tail -n1 $x; done >> HPG.log
   80  for x in `ls agg/*/HPG*table.log`; do echo $x; tail -n2 $x; done > HPG.log
   81  for x in `ls agg/*/HPG*table.log`; do echo $x; tail -n3 $x; done > HPG.log
   82  for x in `ls agg/*/HPG*csv`; do echo $x; tail -n3 $x; done > HPG.log

for x in `ls agg/20230201/*csv`; do awk -F, 'END{print substr(FILENAME,14,3)" "$2" "$3 }' $x; done |sort -nk3 > all


for x in `ls agg/*/VCB*csv`; do awk -F, 'END{print substr(FILENAME,5,8)" "substr(FILENAME,14,3)" "$2" "$3 }' $x; done |sort -nk1|egrep -v "20221207|20221208|20221209"


for x in `ls vnindex/*/VN*csv`; do awk -F, 'END{print substr(FILENAME,9,8)" "substr(FILENAME,18,7)" "$1" "$2 }' $x; done |sort -nk1|egrep -v "20221207|20221208|20221209"

for s in `ls agg/20230207/*.csv`; do echo $s|cut -d/ -f 3|cut -d_ -f1; done > symbols2.txt
for s in `ls agg/20230207/*HOSE*.csv`; do echo $s|cut -d "/" -f 3|cut -d "_" -f1; done > hose.txt
for s in `ls agg/20230207/*HOSE*.csv`; do echo $s|awk -F/ '{print substr($3,0,3)}'; done > hose.txt
total=`cat symbols.txt |wc -l`;
count=0;
for s in `cat symbols.txt`; do 
echo $s; 
file=`ls agg/*/$s*csv`
for x in $file; do awk -F, 'END{print substr(FILENAME,5,8)" "substr(FILENAME,14,3)" "$2" "$3 }' $x; done |sort -nk1|egrep -v "20221207|20221208|20221209" > all/$s.txt
done|more

total=`cat symbols.txt |wc -l`;
count=0;
for s in `cat symbols.txt`; do
count=`bc <<< $count' +1'`
echo $s" "$count"/"$total" "`bc <<< 'scale=4; '$count'*100/'$total`
   tail -n 10 all/$s.txt > process/$s.txt
done




total=`cat hose.txt |wc -l`;
count=0;
echo > update.txt
for s in `cat hose.txt`; do 
   ##echo $s;
   ##expr length $s
   current=`date +%s%3N`; 
   current=`bc <<< $current'/(5*60*1000)*5*60*1000 + 7*60*60*1000 - 60*60*1000'`;
   Y=`date +"%Y"`;
   m=`date +"%m"`;
   d=`date +"%d"`;   
   ##echo $s;
   for x in `ls trans/20230208/$s*.txt`; do 
      awk -F, -v current=$current -v symbol=$s -v Y=$Y -v m=$m -v d=$d\
      '{t=substr($5,2,8);  gsub(":"," ",t);  time=mktime(Y" "m" "d" "t)*1000; if(time > current) {print symbol" "time" "$1" "$2" "$3" "$0}}'\
      $x; 
   done >> update.txt
done
grep sd update.txt|sort -nk5|tail -n 20
grep bu update.txt|sort -nk5|tail -n 20




|more


print "Number of seconds since the Epoch = " mktime("2014 12 14 30 20 10")


awk -v val1=2 -v val2="HI" 'BEGIN{print val1;print val2}'
date +%s%3N


for s in `cat symbols.txt`; do 
   awk 'BEGIN{sum = 0}{ sum += $4}END{print $2" "sum}' process/$s.txt
done

while true; do node dumpdaily.js; node muaban.js date=20230208 ; ./top.sh; sleep 300; done

while true; do node quickdumpdaily.js; node muaban.js date=20230208 ; ./top.sh; sleep 20; done

while true; do node quickdumpdaily.js; node muaban.js date=20230208 ; cp agg/20230208/HPG_HOSE_table.log HPG.log; sleep 20; done

ln -s agg/`date +"%Y%m%d"`/HPG_HOSE_table.log HPG`date +"%Y%m%d"`.log
while true; do node quickdumpdaily.js; node muaban.js date=`date +"%Y%m%d"` ; cp agg/`date +"%Y%m%d"`/HPG_HOSE_table.log HPG.log; sleep 20; done

ln -s vnindex/`date +"%Y%m%d"`/VNINDEX_HOSE_table.log VNINDEX`date +"%Y%m%d"`.log
while true; do node dumpdaily.js; node muaban.js date=`date +"%Y%m%d"` ; ./top.sh; sleep 200; done


ln -s vnindex/`date +"%Y%m%d"`/VNINDEX_HOSE_table.log VNINDEX`date +"%Y%m%d"`.log
while true; do node script/dumpdaily.js; node script/muaban.js date=`date +"%Y%m%d"` ; ./top.sh; sleep 200; done

while true; do node script/dumpdaily2.js stock=ssi; node script/muaban.js date=`date +"%Y%m%d"` ; ./top.sh; sleep 200; done
while true; do node script/quickdumpdaily.js; node script/muaban.js date=`date +"%Y%m%d"` ; cp agg/`date +"%Y%m%d"`/HPG_HOSE_table.log HPG.log; sleep 20; done

s="HPG SBS STB PLC CTG MBB"
for x in $s ;do echo $x; 
ln -s $PWD/agg/`date +"%Y%m%d"`/$x"_"*"_table.log" links/$x`date +"%Y%m%d"`.log
done

s="HPG SBS STB PLC CTG MBB HBC HHV KSB LCG NKG"
for x in $s ;do echo $x; 
ln -s $PWD/agg/`date +"%Y%m%d"`/$x"_"*"_table.log" links/$x`date +"%Y%m%d"`.log
done


s="HPG SBS STB PLC CTG MBB"
for x in $s ;do echo $x; 
d=`date +"%d"`
d=`bc <<< $d' - 1'`
ln -s $PWD/agg/`date +"%Y%m"$d`/$x"_"*"_table.log" links/$x`date +"%Y%m"$d`.log
done

s="ACB BCM BID BVH CTG FPT GAS GVR HDB HPG MBB MSN MWG NVL PDR PLX POW SAB SSI STB TCB TPB VCB VHM VIB VIC VJC VNM VPB VRE"
for x in $s ;do echo $x; 
ln -s $PWD/agg/`date +"%Y%m%d"`/$x"_"*"_table.log" links/vn30/$x`date +"%Y%m%d"`.log
done

ln -s agg/`date +"%Y%m%d"`/HPG_HOSE_table.log HPG`date +"%Y%m%d"`.log

ln -s $PWD/agg/`date +"%Y%m%d"`/CTG_*_table.log links/CTG_`date +"%Y%m%d"`.log


while true; do node script/quickdumpdaily.js; node script/muaban.js date=`date +"%Y%m%d"` ; cp agg/`date +"%Y%m%d"`/HPG_HOSE_table.log HPG.log; sleep 20; done


for s in `cat symbols.txt`; do 
   awk 'BEGIN{sum = 0; sum_sd; sum_bu}{ sum += $4; sum_sd += $7; sum_bu += $6;}END{if(sum_sd == 0) sum_sd = 0.001; print $2" "sum" bu "sum_bu" sd "sum_sd" busd "(sum_bu/sum_sd)}' process/$s.txt
done


total=`cat symbols.txt |wc -l`;
count=0;
for s in `cat symbols.txt`; do
count=`bc <<< $count' +1'`
echo $s" "$count"/"$total" "`bc <<< 'scale=4; '$count'*100/'$total`
grep -v acum_busd all/$s"avg.txt"|awk 'BEGIN{sum = 0; sum_sd; sum_bu; count; minbusd=99999999999; maxbusd=-99999999999; minsd=99999999999; maxsd=-99999999999; minbu=99999999999; maxbu=-99999999999}'\
'{ sum += $4; sum_sd += $7; sum_bu += $6; count += 1; if(minbusd> $4) minbusd = $4; if(maxbusd < $4) maxbusd = $4;'\
'if(minsd> $7 && length($7) > 0) minsd = $7; if(maxsd < $7) maxsd = $7;'\
'if(minbu > $6 && length($6) > 0) minbu = $6; if(maxbu < $6) maxbu = $6;}'\
'END{if(sum_sd == 0) sum_sd = 0.001; print $2" "sum" bu "sum_bu" sd "sum_sd" busd "sum_bu/sum_sd" '\
'abu "int(sum_bu/count)" asd "int(sum_sd/count)" abusd "int(sum/count)" minbusd "minbusd" maxbusd "maxbusd" minsd "minsd" maxsd "maxsd" minbu "minbu" maxbu "maxbu}' > process/$s"avg.txt"
done






nohup node  script/dumpdaily2.js stock=24HMONEY >> dum.log 2>&1 < /dev/null &
nohup node  script/dumpdaily2.js stock=VIETSTOCK >> dum.log 2>&1 < /dev/null &
nohup node  script/dumpdaily2.js stock=SSI >> dum.log 2>&1 < /dev/null &
nohup node  script/dumpdaily2.js stock=TCBS >> dum.log 2>&1 < /dev/null &
nohup node  script/dumpdaily2.js stock=VCI >> dum.log 2>&1 < /dev/null &
nohup node  script/dumpdaily2.js stock=VCBS >> dum.log 2>&1 < /dev/null &




while true; do node script/stat.js >> stat.log sleep 30; done